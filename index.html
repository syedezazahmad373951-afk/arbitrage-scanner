<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Funding Arbitrage Scanner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .refresh-button {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .refresh-button:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .refresh-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Statistics Cards */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .stat-card h3 {
            color: #667eea;
            font-size: 0.9em;
            text-transform: uppercase;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .stat-unit {
            color: #999;
            font-size: 0.9em;
        }

        /* Exchange Cards */
        .exchanges-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .exchange-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .exchange-header {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .exchange-header h2 {
            font-size: 1.5em;
        }

        .exchange-status {
            padding: 4px 12px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 0.85em;
        }

        .exchange-status.loading {
            background: rgba(255, 193, 7, 0.3);
            color: #fff3cd;
        }

        .exchange-status.error {
            background: rgba(220, 53, 69, 0.3);
            color: #f8d7da;
        }

        .exchange-status.success {
            background: rgba(40, 167, 69, 0.3);
            color: #d4edda;
        }

        .exchange-content {
            padding: 20px;
        }

        .price-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .price-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .price-item {
            display: flex;
            flex-direction: column;
        }

        .price-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .price-value {
            font-size: 1.4em;
            font-weight: bold;
            color: #333;
        }

        .price-sub {
            font-size: 0.8em;
            color: #999;
        }

        /* Arbitrage Table */
        .table-section {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .table-header {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .table-header h2 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .table-filters {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-group label {
            font-size: 0.9em;
        }

        .filter-group input,
        .filter-group select {
            padding: 6px 12px;
            border-radius: 5px;
            border: 1px solid #ddd;
            background: white;
            color: #333;
        }

        .table-content {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #333;
            white-space: nowrap;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #dee2e6;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .type-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .type-spot {
            background: #d4edda;
            color: #155724;
        }

        .type-funding {
            background: #cfe2ff;
            color: #084298;
        }

        .direction-badge {
            padding: 4px 12px;
            border-radius: 5px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .direction-buy {
            background: #d4edda;
            color: #155724;
        }

        .direction-sell {
            background: #f8d7da;
            color: #721c24;
        }

        .price-cell {
            font-weight: 600;
            color: #333;
        }

        .profit-cell {
            font-weight: bold;
            font-size: 1.1em;
        }

        .profit-positive {
            color: #28a745;
        }

        .profit-negative {
            color: #dc3545;
        }

        .exchange-pair {
            font-weight: 600;
            color: #333;
        }

        .no-data {
            padding: 40px;
            text-align: center;
            color: #999;
        }

        .error-message {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .success-message {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .last-updated {
            text-align: center;
            color: white;
            margin-top: 20px;
            font-size: 0.9em;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            .exchanges-container {
                grid-template-columns: 1fr;
            }

            .price-row {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 0.85em;
            }

            th, td {
                padding: 8px 10px;
            }

            .stat-value {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ’° Funding Arbitrage Scanner</h1>
            <p>Real-time arbitrage opportunities across major exchanges</p>
            <button class="refresh-button" onclick="refreshData()" id="refreshBtn">
                ðŸ”„ Refresh Data
            </button>
            <div class="last-updated" id="lastUpdated">Last updated: Never</div>
        </header>

        <div id="messages"></div>

        <!-- Statistics Cards -->
        <div class="stats-container">
            <div class="stat-card">
                <h3>Total Opportunities</h3>
                <div class="stat-value" id="totalOpportunities">0</div>
            </div>
            <div class="stat-card">
                <h3>Best Profit (Spot)</h3>
                <div class="stat-value profit-positive" id="bestSpotProfit">0%</div>
            </div>
            <div class="stat-card">
                <h3>Best Profit (Funding)</h3>
                <div class="stat-value profit-positive" id="bestFundingProfit">0%</div>
            </div>
            <div class="stat-card">
                <h3>Average Profit</h3>
                <div class="stat-value profit-positive" id="avgProfit">0%</div>
            </div>
        </div>

        <!-- Exchange Cards -->
        <div class="exchanges-container">
            <div class="exchange-card">
                <div class="exchange-header">
                    <h2>Binance</h2>
                    <div class="exchange-status loading" id="binanceStatus">Loading...</div>
                </div>
                <div class="exchange-content" id="binanceContent">
                    <p style="color: #999;">Loading data...</p>
                </div>
            </div>

            <div class="exchange-card">
                <div class="exchange-header">
                    <h2>Bybit</h2>
                    <div class="exchange-status loading" id="bybitStatus">Loading...</div>
                </div>
                <div class="exchange-content" id="bybitContent">
                    <p style="color: #999;">Loading data...</p>
                </div>
            </div>
        </div>

        <!-- Spot Arbitrage Table -->
        <div class="table-section">
            <div class="table-header">
                <h2>ðŸ“Š Spot Arbitrage Opportunities</h2>
                <div class="table-filters">
                    <div class="filter-group">
                        <label>Min Profit:</label>
                        <input type="number" id="spotProfitFilter" value="0.1" step="0.1" style="width: 80px;">
                        <span>%</span>
                    </div>
                </div>
            </div>
            <div class="table-content">
                <table id="spotTable">
                    <thead>
                        <tr>
                            <th>Symbol</th>
                            <th>Direction</th>
                            <th>Buy At</th>
                            <th>Sell At</th>
                            <th>Price Difference</th>
                            <th>Profit %</th>
                            <th>Volume (24h)</th>
                        </tr>
                    </thead>
                    <tbody id="spotTableBody">
                        <tr>
                            <td colspan="7" class="no-data">Loading spot arbitrage data...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Funding Rate Arbitrage Table -->
        <div class="table-section">
            <div class="table-header">
                <h2>ðŸ“ˆ Funding Rate Arbitrage Opportunities</h2>
                <div class="table-filters">
                    <div class="filter-group">
                        <label>Min Funding:</label>
                        <input type="number" id="fundingRateFilter" value="0" step="0.01" style="width: 80px;">
                        <span>%</span>
                    </div>
                </div>
            </div>
            <div class="table-content">
                <table id="fundingTable">
                    <thead>
                        <tr>
                            <th>Symbol</th>
                            <th>Funding Rate (High)</th>
                            <th>Funding Rate (Low)</th>
                            <th>Difference</th>
                            <th>Arbitrage Profit (8h)</th>
                            <th>Arbitrage Profit (24h)</th>
                            <th>Exchange Pair</th>
                        </tr>
                    </thead>
                    <tbody id="fundingTableBody">
                        <tr>
                            <td colspan="7" class="no-data">Loading funding rate arbitrage data...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let binanceData = {};
        let bybitData = {};

        // API endpoints
        const BINANCE_SPOT_API = 'https://api.binance.com/api/v3/ticker/price';
        const BINANCE_PERPETUAL_API = 'https://fapi.binance.com/fapi/v1/ticker/24hr';
        const BINANCE_FUNDING_RATE = 'https://fapi.binance.com/fapi/v1/fundingRate';
        
        const BYBIT_SPOT_API = 'https://api.bybit.com/v5/market/tickers?category=spot';
        const BYBIT_PERPETUAL_API = 'https://api.bybit.com/v5/market/tickers?category=linear';
        const BYBIT_FUNDING_RATE = 'https://api.bybit.com/v5/market/funding/history?category=linear&limit=1';

        // Popular trading symbols
        const SYMBOLS = ['BTCUSDT', 'ETHUSDT', 'BNBUSDT', 'ADAUSDT', 'DOGEUSDT', 'XRPUSDT', 'SOLUSDT', 'LTCUSDT'];

        async function fetchBinanceData() {
            try {
                const spotResponse = await fetch(BINANCE_SPOT_API);
                const perpetualResponse = await fetch(BINANCE_PERPETUAL_API);
                
                const spotData = await spotResponse.json();
                const perpetualData = await perpetualResponse.json();

                binanceData.spot = {};
                binanceData.perpetual = {};
                binanceData.fundingRates = {};

                spotData.forEach(item => {
                    if (SYMBOLS.includes(item.symbol)) {
                        binanceData.spot[item.symbol] = parseFloat(item.price);
                    }
                });

                perpetualData.forEach(item => {
                    if (SYMBOLS.includes(item.symbol)) {
                        binanceData.perpetual[item.symbol] = parseFloat(item.lastPrice);
                        binanceData.fundingRates[item.symbol] = {
                            perpetual_price: parseFloat(item.lastPrice),
                            volume_24h: parseFloat(item.quoteAsset)
                        };
                    }
                });

                // Fetch funding rates
                const fundingResponse = await fetch(BINANCE_FUNDING_RATE + '?limit=100');
                const fundingRates = await fundingResponse.json();
                
                fundingRates.forEach(item => {
                    if (binanceData.fundingRates[item.symbol]) {
                        binanceData.fundingRates[item.symbol].funding_rate = parseFloat(item.fundingRate);
                    }
                });

                return true;
            } catch (error) {
                console.error('Error fetching Binance data:', error);
                return false;
            }
        }

        async function fetchBybitData() {
            try {
                const spotResponse = await fetch(BYBIT_SPOT_API);
                const perpetualResponse = await fetch(BYBIT_PERPETUAL_API);
                
                const spotJson = await spotResponse.json();
                const perpetualJson = await perpetualResponse.json();

                bybitData.spot = {};
                bybitData.perpetual = {};
                bybitData.fundingRates = {};

                if (spotJson.result && spotJson.result.list) {
                    spotJson.result.list.forEach(item => {
                        if (SYMBOLS.includes(item.symbol)) {
                            bybitData.spot[item.symbol] = parseFloat(item.lastPrice);
                        }
                    });
                }

                if (perpetualJson.result && perpetualJson.result.list) {
                    perpetualJson.result.list.forEach(item => {
                        const symbol = item.symbol.replace('USDT', 'USDT');
                        if (SYMBOLS.includes(symbol)) {
                            bybitData.perpetual[symbol] = parseFloat(item.lastPrice);
                            bybitData.fundingRates[symbol] = {
                                perpetual_price: parseFloat(item.lastPrice),
                                volume_24h: parseFloat(item.volume24h || 0),
                                funding_rate: parseFloat(item.fundingRate || 0)
                            };
                        }
                    });
                }

                return true;
            } catch (error) {
                console.error('Error fetching Bybit data:', error);
                return false;
            }
        }

        function displayExchangeCard(exchange, data, statusId, contentId) {
            const statusEl = document.getElementById(statusId);
            const contentEl = document.getElementById(contentId);

            if (!data.spot || Object.keys(data.spot).length === 0) {
                statusEl.className = 'exchange-status error';
                statusEl.textContent = 'Error';
                contentEl.innerHTML = '<p style="color: #dc3545;">Failed to fetch data</p>';
                return;
            }

            statusEl.className = 'exchange-status success';
            statusEl.textContent = 'Connected';

            let html = '';
            for (let i = 0; i < Math.min(4, SYMBOLS.length); i++) {
                const symbol = SYMBOLS[i];
                const spotPrice = data.spot[symbol];
                const perpPrice = data.perpetual[symbol];
                const fundingRate = data.fundingRates[symbol]?.funding_rate || 0;

                if (spotPrice) {
                    html += `
                        <div class="price-row">
                            <div class="price-item">
                                <span class="price-label">${symbol} Spot</span>
                                <span class="price-value">$${spotPrice.toFixed(2)}</span>
                            </div>
                            <div class="price-item">
                                <span class="price-label">${symbol} Perpetual</span>
                                <span class="price-value">$${perpPrice?.toFixed(2) || 'N/A'}</span>
                                ${fundingRate !== 0 ? `<span class="price-sub">Funding: ${(fundingRate * 100).toFixed(4)}%</span>` : ''}
                            </div>
                        </div>
                    `;
                }
            }

            contentEl.innerHTML = html || '<p style="color: #999;">No data available</p>';
        }

        function calculateSpotArbitrage() {
            const opportunities = [];

            for (const symbol of SYMBOLS) {
                const binanceSpot = binanceData.spot[symbol];
                const bybitSpot = bybitData.spot[symbol];

                if (binanceSpot && bybitSpot) {
                    // Binance to Bybit (buy Binance, sell Bybit)
                    const profit1 = ((bybitSpot - binanceSpot) / binanceSpot) * 100;
                    if (profit1 > 0.05) {
                        opportunities.push({
                            type: 'spot',
                            symbol: symbol,
                            direction: 'Buy Binance â†’ Sell Bybit',
                            buy_exchange: 'Binance',
                            buy_price: binanceSpot,
                            sell_exchange: 'Bybit',
                            sell_price: bybitSpot,
                            price_diff: bybitSpot - binanceSpot,
                            profit: profit1,
                            volume_24h: binanceData.fundingRates[symbol]?.volume_24h || 0
                        });
                    }

                    // Bybit to Binance (buy Bybit, sell Binance)
                    const profit2 = ((binanceSpot - bybitSpot) / bybitSpot) * 100;
                    if (profit2 > 0.05) {
                        opportunities.push({
                            type: 'spot',
                            symbol: symbol,
                            direction: 'Buy Bybit â†’ Sell Binance',
                            buy_exchange: 'Bybit',
                            buy_price: bybitSpot,
                            sell_exchange: 'Binance',
                            sell_price: binanceSpot,
                            price_diff: binanceSpot - bybitSpot,
                            profit: profit2,
                            volume_24h: bybitData.fundingRates[symbol]?.volume_24h || 0
                        });
                    }
                }
            }

            return opportunities.sort((a, b) => b.profit - a.profit);
        }

        function calculateFundingArbitrage() {
            const opportunities = [];

            for (const symbol of SYMBOLS) {
                const binanceFunding = binanceData.fundingRates[symbol]?.funding_rate || 0;
                const bybitFunding = bybitData.fundingRates[symbol]?.funding_rate || 0;

                if (binanceFunding !== 0 && bybitFunding !== 0) {
                    const fundingDiff = bybitFunding - binanceFunding;
                    const profit8h = fundingDiff * 3 * 100; // 3 funding periods in 24h
                    const profit24h = fundingDiff * 100;

                    opportunities.push({
                        symbol: symbol,
                        binance_funding: binanceFunding,
                        bybit_funding: bybitFunding,
                        funding_diff: fundingDiff,
                        profit_8h: profit8h,
                        profit_24h: profit24h,
                        exchange_pair: 'Binance â†” Bybit'
                    });
                }
            }

            return opportunities.sort((a, b) => Math.abs(b.funding_diff) - Math.abs(a.funding_diff));
        }

        function displaySpotArbitrage(opportunities) {
            const tbody = document.getElementById('spotTableBody');
            const minProfit = parseFloat(document.getElementById('spotProfitFilter').value);

            const filtered = opportunities.filter(o => o.profit >= minProfit);

            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="no-data">No spot arbitrage opportunities found above threshold</td></tr>';
                return;
            }

            tbody.innerHTML = filtered.slice(0, 20).map(opp => `
                <tr>
                    <td class="exchange-pair">${opp.symbol}</td>
                    <td>
                        <span class="direction-badge direction-buy">BUY ${opp.buy_exchange}</span>
                        <br><small>${opp.buy_exchange} â†’ ${opp.sell_exchange}</small>
                    </td>
                    <td class="price-cell">$${opp.buy_price.toFixed(4)}</td>
                    <td class="price-cell">$${opp.sell_price.toFixed(4)}</td>
                    <td class="price-cell">$${opp.price_diff.toFixed(4)}</td>
                    <td class="profit-cell profit-positive">${opp.profit.toFixed(3)}%</td>
                    <td>${(opp.volume_24h / 1e6).toFixed(2)}M</td>
                </tr>
            `).join('');
        }

        function displayFundingArbitrage(opportunities) {
            const tbody = document.getElementById('fundingTableBody');
            const minFunding = parseFloat(document.getElementById('fundingRateFilter').value);

            const filtered = opportunities.filter(o => Math.abs(o.funding_diff) * 100 >= minFunding);

            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="no-data">No funding rate arbitrage opportunities found above threshold</td></tr>';
                return;
            }

            tbody.innerHTML = filtered.slice(0, 20).map(opp => `
                <tr>
                    <td class="exchange-pair">${opp.symbol}</td>
                    <td><span class="type-badge type-funding">${(opp.binance_funding * 100).toFixed(4)}%</span></td>
                    <td><span class="type-badge type-spot">${(opp.bybit_funding * 100).toFixed(4)}%</span></td>
                    <td class="${opp.funding_diff > 0 ? 'profit-positive' : 'profit-negative'}">${(opp.funding_diff * 100).toFixed(4)}%</td>
                    <td class="${opp.profit_8h > 0 ? 'profit-positive' : 'profit-negative'}">${opp.profit_8h.toFixed(4)}%</td>
                    <td class="${opp.profit_24h > 0 ? 'profit-positive' : 'profit-negative'}">${opp.profit_24h.toFixed(4)}%</td>
                    <td>${opp.exchange_pair}</td>
                </tr>
            `).join('');
        }

        function updateStatistics(spotOpp, fundingOpp) {
            const allOpp = spotOpp.length + fundingOpp.length;
            document.getElementById('totalOpportunities').textContent = allOpp;

            if (spotOpp.length > 0) {
                const bestSpot = spotOpp[0].profit;
                document.getElementById('bestSpotProfit').textContent = bestSpot.toFixed(3) + '%';
            }

            if (fundingOpp.length > 0) {
                const bestFunding = Math.max(...fundingOpp.map(o => Math.abs(o.profit_24h)));
                document.getElementById('bestFundingProfit').textContent = bestFunding.toFixed(4) + '%';
            }

            const allProfits = [
                ...spotOpp.map(o => o.profit),
                ...fundingOpp.map(o => o.profit_24h)
            ];

            if (allProfits.length > 0) {
                const avg = allProfits.reduce((a, b) => a + b) / allProfits.length;
                document.getElementById('avgProfit').textContent = avg.toFixed(3) + '%';
            }
        }

        function showMessage(message, type = 'info') {
            const messagesDiv = document.getElementById('messages');
            const messageEl = document.createElement('div');
            messageEl.className = `${type}-message`;
            messageEl.textContent = message;
            messagesDiv.appendChild(messageEl);

            setTimeout(() => messageEl.remove(), 5000);
        }

        async function refreshData() {
            const btn = document.getElementById('refreshBtn');
            btn.disabled = true;

            document.getElementById('binanceStatus').className = 'exchange-status loading';
            document.getElementById('binanceStatus').textContent = 'Loading...';
            document.getElementById('bybitStatus').className = 'exchange-status loading';
            document.getElementById('bybitStatus').textContent = 'Loading...';

            const [binanceSuccess, bybitSuccess] = await Promise.all([
                fetchBinanceData(),
                fetchBybitData()
            ]);

            displayExchangeCard('Binance', binanceData, 'binanceStatus', 'binanceContent');
            displayExchangeCard('Bybit', bybitData, 'bybitStatus', 'bybitContent');

            const spotOpp = calculateSpotArbitrage();
            const fundingOpp = calculateFundingArbitrage();

            displaySpotArbitrage(spotOpp);
            displayFundingArbitrage(fundingOpp);

            updateStatistics(spotOpp, fundingOpp);

            document.getElementById('lastUpdated').textContent = `Last updated: ${new Date().toLocaleTimeString()}`;

            if (binanceSuccess && bybitSuccess) {
                showMessage('âœ… Data updated successfully!', 'success');
            } else {
                showMessage('âš ï¸ Some exchanges failed to load. Check console for details.', 'error');
            }

            btn.disabled = false;
        }

        // Event listeners for filters
        document.getElementById('spotProfitFilter').addEventListener('change', () => {
            const opportunities = calculateSpotArbitrage();
            displaySpotArbitrage(opportunities);
        });

        document.getElementById('fundingRateFilter').addEventListener('change', () => {
            const opportunities = calculateFundingArbitrage();
            displayFundingArbitrage(opportunities);
        });

        // Auto-refresh every 30 seconds
        setInterval(refreshData, 30000);

        // Initial load
        refreshData();
    </script>
</body>
</html>